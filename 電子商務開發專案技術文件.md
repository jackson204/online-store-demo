# 電子商務開發專案技術文件

## 一、專案簡介與目標

本專案旨在建立一個高效能、可延展且安全的電子商務平台，具備商品瀏覽、購物車、下單、付款、會員管理與後台管理等完整功能。系統採用現代化前後端分離架構，支援多種支付方式，並整合快取、訊息佇列與雲端儲存，確保高可用性與彈性擴展能力。

**主要目標：**
- 提供流暢的商品瀏覽與購物體驗
- 支援多元支付與訂單流程自動化
- 強化會員資料與交易安全
- 具備彈性擴展與高併發處理能力
- 提供後台管理介面，方便營運管理

## 二、系統整體架構

本系統採用前後端分離設計，並結合快取、訊息佇列與雲端儲存，確保高效能與可延展性。

```mermaid
flowchart TD
    subgraph 前端
        A[Web / Mobile App (React / Vue / Angular)]
    end
    subgraph API Gateway
        B[API Gateway]
    end
    subgraph 後端服務
        C[.NET Core API]
        D[後台管理 API]
    end
    subgraph 資料庫
        E[(SQL Server)]
    end
    subgraph 快取
        F[Redis]
    end
    subgraph 檔案儲存
        G[AWS S3 / Azure Blob]
    end
    subgraph 金流
        H[金流 API (信用卡/行動支付/第三方支付)]
    end
    subgraph 訊息佇列
        I[RabbitMQ / Kafka]
    end

    A -->|RESTful API| B
    B --> C
    B --> D
    C -->|查詢/寫入| E
    C -->|Session/熱門商品| F
    C -->|檔案上傳| G
    C -->|訂單/通知事件| I
    C -->|付款請求| H
    D -->|查詢/寫入| E
    D -->|Session| F
    D -->|檔案上傳| G
    D -->|事件通知| I
    I --> C
    I --> D
```

**說明：**
- 前端透過 API Gateway 與後端服務溝通。
- 後端 API 提供商品、購物車、訂單、會員等功能，並與 SQL Server、Redis、檔案儲存、金流 API、訊息佇列整合。
- Redis 用於 session 管理與熱門商品快取。
- 檔案儲存用於商品圖片、附件等。
- 金流 API 提供多元支付整合。
- 訊息佇列用於訂單、通知等事件驅動流程。

## 三、前端（Frontend）

### 技術選型
- React / Vue / Angular（三擇一，依團隊技術棧選用）
- TypeScript（型別安全）
- UI 框架：Ant Design、Vuetify、Material UI 等
- 狀態管理：Redux / Vuex / NgRx
- 路由管理：React Router / Vue Router / Angular Router
- API 請求：Axios / Fetch
- 單元測試：Jest / Mocha / Cypress

### 主要功能模組
- 商品瀏覽與搜尋
- 商品詳情頁
- 購物車管理
- 訂單建立與查詢
- 線上付款流程
- 會員註冊、登入、資料維護
- 訂單歷史與追蹤
- 通知與訊息中心
- 後台管理入口（權限控管）

### 架構重點
- 與 API Gateway 進行 RESTful 通訊
- 採用元件化設計，利於維護與擴充
- 支援 RWD 響應式設計，兼容桌機與行動裝置
- 前端權限控管，敏感頁面需驗證登入
- 支援多語系（i18n）

## 四、後端（Backend API）

### 技術選型
- .NET Core（C#，跨平台高效能 Web API 框架）
- RESTful API 設計
- Entity Framework Core（ORM，資料存取）
- JWT / OAuth2（認證與授權）
- Swagger（API 文件自動化）
- AutoMapper（物件映射）
- Serilog / NLog（日誌管理）
- xUnit / NUnit（單元測試）

### 主要功能模組
- 商品管理（CRUD、分類、庫存）
- 購物車管理（Session/Redis 快取）
- 訂單管理（下單、查詢、狀態流轉）
- 付款整合（金流 API 串接）
- 會員管理（註冊、登入、權限、資料維護）
- 後台管理（商品、訂單、會員、報表）
- 通知與訊息推播（Email、簡訊、站內訊息）
- 事件驅動流程（透過訊息佇列）
- 檔案上傳與管理（圖片、附件）

### 架構重點
- 採用分層架構（Controller / Service / Repository）
- 支援 DI（相依性注入）
- API Gateway 統一入口，利於流量控管與安全
- 支援 CORS，允許跨域請求
- 例外處理與統一回應格式
- 支援高併發與橫向擴展

## 五、資料庫（Database）

### 技術選型
- Microsoft SQL Server（關聯式資料庫，支援高併發與交易式操作）
- Entity Framework Core（ORM，簡化資料存取）

### 主要資料表設計
- 商品（Products）：商品資訊、分類、庫存、價格
- 會員（Users）：帳號、密碼、聯絡資訊、權限
- 訂單（Orders）：訂單主檔、明細、狀態、付款資訊
- 購物車（Carts）：會員購物車內容
- 支付紀錄（Payments）：金流交易紀錄
- 通知（Notifications）：訊息推播、站內通知
- 後台管理員（Admins）：後台帳號、權限

### 架構重點
- 正規化設計，避免資料冗餘
- 支援交易（Transaction）確保資料一致性
- 重要資料加密（如密碼、敏感資訊）
- 定期備份與異地備援
- 支援索引與查詢優化，提升效能

## 六、快取層（Redis）

### 技術選型
- Redis（記憶體型快取系統，支援高效能資料存取與 session 管理）

### 主要應用場景
- Session 管理：用於會員登入狀態、購物車 session
- 熱門商品快取：將熱門商品、分類、促銷資訊快取於記憶體，減少資料庫查詢壓力
- 訂單暫存：下單流程中的暫存資料
- 防止重複提交：利用 Redis 實現訂單防重機制

### 架構重點
- 設定過期時間（TTL），自動清除過期資料
- 支援分散式部署，提升可用性與延展性
- 敏感資料不建議存於快取，避免資安風險
- 監控快取命中率與效能，定期優化快取策略

## 七、檔案儲存（AWS S3 / Azure Blob）

### 技術選型
- AWS S3 或 Azure Blob Storage（雲端物件儲存服務，支援高可用性與彈性擴展）

### 主要應用場景
- 商品圖片、影片、附件上傳與存取
- 會員大頭貼、證件等檔案管理
- 訂單相關附件（如發票、憑證）

### 架構重點
- 前端直傳（Pre-signed URL），減少後端壓力
- 檔案存取權限控管（公開/私有/限時存取）
- 支援多區域備援與自動備份
- 檔案上傳後觸發事件（如縮圖、病毒掃描）
- 檔案 URL 儲存於資料庫，便於管理
- 大檔案分段上傳，提升穩定性

## 八、支付整合設計與安全性考量

### 技術選型
- 金流 API（第三方支付平台，如綠界、藍新、歐付寶、LINE Pay、Apple Pay、Google Pay 等）
- HTTPS（全站加密傳輸）

### 主要應用場景
- 線上信用卡付款
- 行動支付（Apple Pay、Google Pay、LINE Pay）
- 超商代碼/條碼繳費
- 第三方支付（如 PayPal、街口支付等）

### 架構重點
- 付款流程採用金流 API，後端僅保存交易結果，不儲存信用卡敏感資訊
- 支援付款通知（Webhook），即時更新訂單狀態
- 交易資料加密儲存，敏感資訊遮蔽
- 防止重複付款與偽造請求（Nonce、簽章驗證）
- 定期檢查金流 API 安全性與合規性（如 PCI DSS）
- 付款失敗、退款、對帳等異常流程處理
- 付款紀錄與訂單資料關聯，便於查詢與稽核

## 九、訊息佇列（RabbitMQ / Kafka）設計與應用

### 技術選型
- RabbitMQ（輕量級訊息佇列，適合交易型、可靠性高的場景）
- Kafka（高吞吐量、分散式事件串流平台，適合大規模事件處理）

### 主要應用場景
- 訂單建立、付款、出貨等事件通知
- 站內通知、Email、簡訊推播
- 訂單流程異步處理（如庫存扣減、發票開立、物流通知）
- 系統間整合（如 ERP、CRM、物流系統）
- 日誌與行為追蹤資料串流

### 架構重點
- 採用事件驅動設計，提升系統解耦與可延展性
- 支援訊息持久化與重送機制，確保資料不遺失
- 訊息消費端可彈性擴展，支援高併發
- 設計死信佇列（DLQ）處理異常訊息
- 監控訊息佇列健康狀態與流量

## 十、整體效能、延展性與安全性設計重點

### 效能設計
- 前後端分離，減少伺服器渲染負擔
- 靜態資源 CDN 加速，提升載入速度
- Redis 快取熱門資料，降低資料庫壓力
- 資料庫索引與查詢優化，提升查詢效能
- 非同步處理（訊息佇列），避免阻塞
- 支援橫向擴展（多台 API Server、DB Cluster）

### 可延展性設計
- 微服務架構，功能模組可獨立擴展
- API Gateway 統一流量入口，便於流量控管
- 支援容器化部署（Docker/K8s），彈性擴容
- 事件驅動設計，易於整合新服務
- 雲端儲存與佇列，支援大流量與高併發

### 安全性設計
- 全站 HTTPS 加密
- JWT/OAuth2 認證授權，細緻權限控管
- SQL Injection、XSS、CSRF 等資安防護
- 密碼與敏感資料加密儲存
- 金流 API 合規（PCI DSS）
- 日誌與異常監控，及時發現異常行為
- 定期弱點掃描與滲透測試
