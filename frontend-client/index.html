<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»å­å•†åŸ - å•†å“åˆ—è¡¨</title>
    
    <!-- Pico.css CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <style>
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .product-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .product-info {
            padding: 1rem;
        }
        
        .product-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .product-price {
            color: #d32f2f;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        
        .product-stock {
            color: #666;
            font-size: 0.9rem;
        }
        
        .nav-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- å°èˆªåˆ— -->
        <nav class="container-fluid">
            <ul>
                <li><strong>ğŸ›’ é›»å­å•†åŸ</strong></li>
            </ul>
            <ul>
                <li><a href="index.html">å•†å“åˆ—è¡¨</a></li>
                <li><a href="cart.html">è³¼ç‰©è»Š <span v-if="cartCount > 0">({{ cartCount }})</span></a></li>
                <li v-if="isLoggedIn"><a href="orders.html">è¨‚å–®æŸ¥è©¢</a></li>
                <li v-if="isLoggedIn" class="nav-user">
                    <span>ğŸ‘¤ {{ user.name }}</span>
                    <a href="#" @click.prevent="logout">ç™»å‡º</a>
                </li>
                <li v-if="!isLoggedIn"><a href="login.html">ç™»å…¥</a></li>
            </ul>
        </nav>

        <!-- ä¸»è¦å…§å®¹ -->
        <main class="container">
            <h1>å•†å“åˆ—è¡¨</h1>
            
            <!-- Loading ç‹€æ…‹ -->
            <div v-if="loading" aria-busy="true">è¼‰å…¥ä¸­...</div>
            
            <!-- å•†å“ç¶²æ ¼ -->
            <div v-else class="product-grid">
                <article v-for="product in products" :key="product.id" class="product-card">
                    <img :src="product.imageUrl" :alt="product.name" class="product-image">
                    <div class="product-info">
                        <div class="product-name">{{ product.name }}</div>
                        <p class="product-description">{{ product.description }}</p>
                        <div class="product-price">{{ formatPrice(product.price) }}</div>
                        <div class="product-stock">åº«å­˜: {{ product.stock }}</div>
                        <button 
                            @click="addToCart(product.id)" 
                            :disabled="product.stock === 0"
                        >
                            {{ product.stock > 0 ? 'åŠ å…¥è³¼ç‰©è»Š' : 'å·²å”®å®Œ' }}
                        </button>
                    </div>
                </article>
            </div>
            
            <!-- ç„¡å•†å“ -->
            <div v-if="!loading && products.length === 0">
                <p>ç›®å‰æ²’æœ‰å•†å“</p>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script src="js/config.js"></script>
    <script src="js/mock-api.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>
    
    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    products: [],
                    loading: true,
                    isLoggedIn: false,
                    user: null,
                    cartCount: 0
                };
            },
            
            async mounted() {
                this.checkLoginStatus();
                await this.loadProducts();
            },
            
            methods: {
                checkLoginStatus() {
                    this.isLoggedIn = Auth.isLoggedIn();
                    if (this.isLoggedIn) {
                        this.user = Auth.getCurrentUser();
                    }
                },
                
                async loadProducts() {
                    try {
                        this.loading = true;
                        const response = await api.getProducts();
                        
                        if (response.success) {
                            this.products = response.data;
                        } else {
                            alert('è¼‰å…¥å•†å“å¤±æ•—: ' + response.message);
                        }
                    } catch (error) {
                        console.error('è¼‰å…¥å•†å“éŒ¯èª¤:', error);
                        alert('è¼‰å…¥å•†å“æ™‚ç™¼ç”ŸéŒ¯èª¤');
                    } finally {
                        this.loading = false;
                    }
                },
                
                async addToCart(productId) {
                    // æª¢æŸ¥æ˜¯å¦ç™»å…¥
                    if (!this.isLoggedIn) {
                        alert('è«‹å…ˆç™»å…¥æ‰èƒ½åŠ å…¥è³¼ç‰©è»Š');
                        window.location.href = 'login.html';
                        return;
                    }
                    
                    try {
                        const response = await api.addToCart(productId, 1);
                        
                        if (response.success) {
                            Utils.showToast('å·²åŠ å…¥è³¼ç‰©è»Šï¼', 'success');
                            this.cartCount++;
                        } else {
                            alert('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—: ' + response.message);
                        }
                    } catch (error) {
                        console.error('åŠ å…¥è³¼ç‰©è»ŠéŒ¯èª¤:', error);
                        alert('åŠ å…¥è³¼ç‰©è»Šæ™‚ç™¼ç”ŸéŒ¯èª¤');
                    }
                },
                
                formatPrice(price) {
                    return Utils.formatPrice(price);
                },
                
                logout() {
                    Auth.logout();
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
